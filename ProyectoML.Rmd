---
title: "Indicadores de salud para el corazón."
subtitle: "Modelos lineales. Grado en Ciencia de Datos- UV"
author: "Gema Bravo Aguilera, Sandra Paniagua Sanchez, Wilson Paul Portillo Barriga."
date:  "`r Sys.Date()`"  
params:
  lang: ES
lang: "`r switch(params$lang, ES = 'es-ES', EN = 'en-US')`"
output:
  html_document: default
  word_document: default
  pdf_document: default
---


```{r setup, cache = F,  message = F, warning = F, tidy = F, include=FALSE}
# CONFIGURACIÓN GENERAL
library(knitr)
options(width = 100)

opts_chunk$set(echo=F, message = F, error = F, warning = F, comment = NA, fig.align = 'center', dpi = 200, tidy = F, cache.path = '.cache/', fig.path = './figura/')

knit_hooks$set(inline = function(x) {
  
  if(is.numeric(x)) {
    round(x, getOption('digits'))
  } else {
    paste(as.character(x), collapse = ', ')
  }
})

```

```{r, echo = FALSE, include=FALSE}

# Especificamos las librerías necesarias en esta lista

packages = c("tidyverse","knitr", "lubridate", "readr", "dplyr", "forcats", "lubridate", "magrittr", "stringr", "tibble", "tidyr", "datasets", "RColorBrewer","nycflights13", "base", "datasets", "ggplot2", "plotly", "highcharter")

package.check <- lapply(packages, FUN = function(x) {
  if (!require(x, character.only = TRUE)) {
    install.packages(x, dependencies = TRUE,repos='http://cran.rediris.es')
  }
  library(x, character.only = TRUE)
})

search()

```

\bigskip

\bigskip

\noindent\makebox[\linewidth]{\rule{\textwidth}{0.4pt}}

\bigskip

\tableofcontents

\bigskip

\noindent\makebox[\linewidth]{\rule{\textwidth}{0.4pt}}


\newpage



# 1. Introducción del trabajo

El objetivo de este trabajo es analizar los datos recogidos por 





#Carga de datos

```{r}

data <- read_csv("data/heart_disease_health_indicators_BRFSS2015.csv", col_types = cols(
  HeartDiseaseorAttack = col_double(),
  Smoker = col_double(),
  Veggies = col_double(),
  MentHlth = col_double(),
  Education = col_double(),
  HighBP = col_double(),
  Stroke = col_double(),
  HvyAlcoholConsump = col_double(),
  PhysHlth = col_double(),
  Income = col_double(),
  HighChol = col_double(),
  Diabetes = col_double(),
  AnyHealthcare = col_double(),
  DiffWalk = col_double(),
  CholCheck = col_double(),
  PhysActivity = col_double(),
  NoDocbcCost = col_double(),
  Sex = col_double(),
  BMI = col_double(),
  Fruits = col_double(),
  GenHlth = col_double(),
  Age = col_double()
))

datos <- data %>% 
  rename(Enfermedad_Cardiaca_Ataque = HeartDiseaseorAttack,
                         Fumador = Smoker,
                         Verduras = Veggies,
                         Salud_Mental = MentHlth,
                         Educacion = Education,
                         Presion_Sanginea_Alta = HighBP,
                         Ataque = Stroke,
                         Consumo_Alcohol = HvyAlcoholConsump,  #Hombre + 14 bebidas alcholicas/semana
                                                               #mujer + 7 bebidas alcholicas/semana
                         Salud_Fisica = PhysHlth,
                         Ingreso = Income,
                         Colesterol_Alto = HighChol,
                         Cuidado_Salud = AnyHealthcare,
                         Dificultad_Andar = DiffWalk,
                         Control_Colesterol = CholCheck,
                         Actividad_Fisica = PhysActivity,
                         No_Doctor_Caro = NoDocbcCost,
                         Sexo = Sex,
                         IMC = BMI,
                         Frutas = Fruits,
                         Salud_General = GenHlth,
                         Edad = Age) # 13 categorias de edad

```


# Transformación de datos

En los datos cargados la variable Age toma valores numéricos (1 al 13) que en
verdad se corresponden con una variable factor donde se representan los grupos 
de edad. 

```{r}

data$Age <- factor(data$Age,                                   
                   levels=c(1,2,3,4,5,6,7,8,9,10,11,12,13),
                   labels= c("Age 18 to 24", "Age 25 to 29", "Age 30 to 34", "Age 35 to 39", "Age 40 to 44", "Age 45 to 49", "Age 50 to 54", "Age 55 to 59", "Age 60 to 64", "Age 65 to 69", "Age 70 to 74", "Age 75 to 79", "Age 80 or older"))

```



# 2. Validación para medir la predictividad del modelo

Leemos el banco de datos y construimos los conjuntos de entrenamiento y validación.

```{r}

set.seed(12345)

# Establecemos el porcentaje de observaciones para el conjunto de entrenamiento y prueba

porcentaje_entrenamiento <- 0.7

# Obtenemos el número de observaciones para el entrenamiento
observaciones <- round(porcentaje_entrenamiento * nrow(data)) 

seleccion <- sample(nrow(data), observaciones)
entrenamiento <- data[seleccion,]          # Conjunto de entrenamiento
test <- data[-seleccion,]                   # Conjunto de validación
```

Lo primero que haremos será comprobar la capacidad de predicción del 
modelo lineal.

Como variable respuesta tenemos: HeartDiseaseorAttack

Ya que nos interesa saber de que depende este evento, por ello usamos 
el resto de variables como predictoras. Estimamos los modelos usando el conjunto de datos del banco de entrenamiento.


```{r}
#
ajuste <- lm(HeartDiseaseorAttack ~ ., data=entrenamiento)
summary(ajuste)
```



```{r}
(ecm_ajuste <- mean(ajuste$residuals^2)) #  Error Cuadrático Medio de ajuste

```



De esa forma hemos podido valorar la bondad de ajuste del modelo utilizando el _error cuadrático medio de ajuste_. Para valorar la bondad de predicción, predecimos los datos del banco de validación, utilizando la estimación de los coeficientes que acabamos de obtener, y calculamos el error cuadrático medio de esas predicciones


```{r}
prediccion <- predict(ajuste,test)
(ecm <- mean((test$HeartDiseaseorAttack-prediccion)^2)) # Error Cuadrático Medio de predicción
```



```{r}
test$
```



